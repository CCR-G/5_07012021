(()=>{"use strict";class t{constructor(t){this._id=t._id,this.name=t.name,this.price=t.price,this.description=t.description,this.varnish=t.varnish,this.imageUrl=t.imageUrl}}function e(t,e=document){const a=e.querySelector(`[data='${t}']`);if(!(a instanceof HTMLElement))throw new Error(`data='${t}' could not be found or is not an HTMLElement`);return a}function a(t){const a=e("basket-quantity");a.textContent=t.getItemsNumber(),window.addEventListener("storage",(()=>{console.log("TESTEST"),a.textContent=t.getItemsNumber()}))}class i{constructor(t,e,a){this._id=t._id+e,this.furniture=t,this.customisation=e,this.quantity=a,this.updated_quantity_event=new CustomEvent("updated_quantity",{detail:{updated_basket_item:this}})}getBasketItemTotalPrice(){return this.furniture.price*this.quantity}addToQuantity(t){this.quantity+=t}removeFromQuantity(t){this.quantity=t||0}clear(){this.quantity=0,window.dispatchEvent(this.updated_quantity_event)}updateQuantity(t){this.quantity=t,window.dispatchEvent(this.updated_quantity_event)}}class s{constructor(){this.basket_storage={},this.updateBasket(),a(this),window.addEventListener("updated_quantity",(t=>{this.replaceItem(t.detail.updated_basket_item)}))}updateBasket(){const t=window.localStorage.getItem("basket");if(t){const e=JSON.parse(t);for(const t in e){const a=new i(e[t].furniture,e[t].customisation,e[t].quantity);this.add(a)}}}replaceItem(t){this.basket_storage[t._id]=t,this.basket_storage[t._id].quantity||delete this.basket_storage[t._id],a(this),this.updateLocalStorage()}add(t){this.basket_storage[t._id]?this.basket_storage[t._id].addToQuantity(t.quantity):this.basket_storage[t._id]=t,this.updateLocalStorage()}clear(){this.basket_storage={},this.updateLocalStorage()}getItemsNumber(){let t=0;for(const e in this.basket_storage)t+=this.basket_storage[e].quantity;return t}isEmpty(){return 0===this.getItemsNumber()}getBasketTotalPrice(){let t=0;for(const e in this.basket_storage)t+=this.basket_storage[e].getBasketItemTotalPrice();return t}getBasketStorage(){return this.basket_storage}updateLocalStorage(){const t=JSON.stringify(this.basket_storage);window.localStorage.setItem("basket",t)}}function n(){window.location="index.html"}!function(){const a=new s,o=function(){const t=document.location.search;return new URLSearchParams(t).get("id")||null}();o||n(),async function(e){const a=await fetch(`http://localhost:3000/api/furniture/${e}`);if(!a.ok)throw new Error(`Error ${a.status} : Item ${e} could not be retrieved.`);const i=await a.json();return new t(i)}(o).catch(n).then((t=>{!function(t,e=document){const a=e.querySelector("[data='item-name']");a&&(a.textContent=t.name);const i=e.querySelector("[data='item-link']");i&&(i.href=`item.html?id=${t._id}`,i.title=`Naviguer vers la page ${t.name}`);const s=e.querySelector("[data='item-price']");s&&(s.textContent=t.price);const n=e.querySelector("[data='item-description']");n&&(n.textContent=t.description);const o=e.querySelector("[data='item-image']");o&&(o.src=t.imageUrl);const r=e.querySelector("[data='item-customisation']");r&&t.varnish.forEach((t=>{const e=document.createElement("option");e.textContent=t,r.appendChild(e)}))}(t),function(t,a){const s=e("basket-add-form");s.addEventListener("submit",(e=>{e.preventDefault();const n=parseInt(s.quantity_input.value),o=s.customisation_select.value,r=new i(a,o,n);t.add(r),s.reset()}))}(a,t)}))}()})();