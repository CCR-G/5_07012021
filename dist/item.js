(()=>{"use strict";class t{constructor(t){this._id=t._id,this.name=t.name,this.price=t.price,this.description=t.description,this.varnish=t.varnish,this.imageUrl=t.imageUrl}}function e(t,e=document){const i=e.querySelector(`[data='${t}']`);if(!(i instanceof HTMLElement))throw new Error(`data='${t}' could not be found or is not an HTMLElement`);return i}function i(t){const i=e("basket-quantity");i.textContent=t.quantity,window.addEventListener("storage",(()=>{console.log("TESTEST"),i.textContent=t.quantity}))}class a{constructor(t,e,i){this._id=t._id+e,this.furniture=t,this.customisation=e,this.quantity=i,this.updated_quantity_event=new CustomEvent("updated_quantity",{detail:{updated_basket_item:this}})}get totalPrice(){return this.furniture.price*this.quantity}addToQuantity(t){this.quantity+=t}removeFromQuantity(t){this.quantity=t||0}clear(){this.quantity=0,window.dispatchEvent(this.updated_quantity_event)}updateQuantity(t){this.quantity=t,window.dispatchEvent(this.updated_quantity_event)}}class n{constructor(){this.basket_storage={},this.updateBasket(),i(this),window.addEventListener("updated_quantity",(t=>{this.replaceItem(t.detail.updated_basket_item)}))}updateBasket(){const t=window.localStorage.getItem("basket");if(t){const e=JSON.parse(t);for(const t in e){const i=new a(e[t].furniture,e[t].customisation,e[t].quantity);this.add(i)}}}replaceItem(t){this.basket_storage[t._id]=t,this.basket_storage[t._id].quantity||delete this.basket_storage[t._id],i(this),this.updateLocalStorage()}add(t){this.basket_storage[t._id]?this.basket_storage[t._id].addToQuantity(t.quantity):this.basket_storage[t._id]=t,this.updateLocalStorage()}clear(){this.basket_storage={},this.updateLocalStorage()}get quantity(){let t=0;for(const e in this.basket_storage)t+=this.basket_storage[e].quantity;return t}get isEmpty(){return 0===this.quantity}get totalPrice(){let t=0;for(const e in this.basket_storage)t+=this.basket_storage[e].totalPrice;return t}get content(){return this.basket_storage}updateLocalStorage(){const t=JSON.stringify(this.basket_storage);window.localStorage.setItem("basket",t)}}function s(){window.location="index.html"}!function(){const i=new n,o=function(){const t=document.location.search;return new URLSearchParams(t).get("id")||null}();o||s(),async function(e){const i=await fetch(`http://localhost:3000/api/furniture/${e}`);if(!i.ok)throw new Error(`Error ${i.status} : Item ${e} could not be retrieved.`);const a=await i.json();return new t(a)}(o).catch(s).then((t=>{!function(t,e=document){const i=e.querySelector("[data='item-name']");i&&(i.textContent=t.name);const a=e.querySelector("[data='item-link']");a&&(a.href=`item.html?id=${t._id}`,a.title=`Naviguer vers la page ${t.name}`);const n=e.querySelector("[data='item-price']");n&&(n.textContent=t.price);const s=e.querySelector("[data='item-description']");s&&(s.textContent=t.description);const o=e.querySelector("[data='item-image']");o&&(o.src=t.imageUrl);const r=e.querySelector("[data='item-customisation']");r&&t.varnish.forEach((t=>{const e=document.createElement("option");e.textContent=t,r.appendChild(e)}))}(t),function(t,i){const n=e("basket-add-form");n.addEventListener("submit",(e=>{e.preventDefault();const s=parseInt(n.quantity_input.value),o=n.customisation_select.value,r=new a(i,o,s);t.add(r),n.reset()}))}(i,t)}))}()})();